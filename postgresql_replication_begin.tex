\chapter{Репликация}
\section{Введение}
Репликация (англ. replication)~--- механизм синхронизации содержимого нескольких копий объекта (например, содержимого базы данных). 
Репликация~--- это процесс, под которым понимается копирование данных из одного источника на множество других и наоборот.
При репликации изменения, сделанные в одной копии объекта, могут быть распространены в другие копии. Репликация может быть 
синхронной или асинхронной.

В случае синхронной репликации, если данная реплика обновляется, все другие реплики того же фрагмента данных 
также должны быть обновлены в одной и той же транзакции. Логически это означает, что существует лишь одна версия данных.
В большинстве продуктов синхронная репликация реализуется с помощью триггерных процедур (возможно, скрытых и управляемых системой). 
Но синхронная репликация имеет тот недостаток, что она создаёт дополнительную нагрузку при выполнении всех транзакций, 
в которых обновляются какие-либо реплики (кроме того, могут возникать проблемы, связанные с доступностью данных).

В случае асинхронной репликации обновление одной реплики распространяется на другие спустя некоторое время, 
а не в той же транзакции. Таким образом, при асинхронной репликации вводится задержка, или время ожидания, в течение которого 
отдельные реплики могут быть фактически неидентичными (то есть определение реплика оказывается не совсем подходящим, 
поскольку мы не имеем дело с точными и своевременно созданными копиями).
В большинстве продуктов асинхронная репликация реализуется посредством чтения журнала транзакций или постоянной очереди 
тех обновлений, которые подлежат распространению. Преимущество асинхронной репликации состоит в том, что 
дополнительные издержки репликации не связаны с транзакциями обновлений, которые могут иметь важное значение 
для функционирования всего предприятия и предъявлять высокие требования к производительности.
К недостаткам этой схемы относится то, что данные могут оказаться несовместимыми (то есть несовместимыми с точки зрения 
пользователя). Иными словами, избыточность может проявляться на логическом уровне, а это, строго говоря, означает, 
что термин контролируемая избыточность в таком случае не применим.

Рассмотрим кратко проблему согласованности (или, скорее, несогласованности). 
Дело в том, что реплики могут становиться несовместимыми в результате ситуаций, которые трудно (или даже 
невозможно) избежать и последствия которых трудно исправить.
В частности, конфликты могут возникать по поводу того, в каком порядке должны применяться обновления. 
Например, предположим, что в результате выполнения транзакции А происходит вставка строки в реплику X, 
после чего транзакция B удаляет эту строку, а также допустим, что Y~--- реплика X. Если обновления распространяются на Y, 
но вводятся в реплику Y в обратном порядке (например, из-за разных задержек при передаче), то транзакция B не находит в Y 
строку, подлежащую удалению, и не выполняет своё действие, после чего транзакция А вставляет эту строку. Суммарный эффект 
состоит в том, что реплика Y содержит указанную строку, а реплика X~--- нет.

В целом задачи устранения конфликтных ситуаций и обеспечения согласованности реплик являются весьма сложными. 
Следует отметить, что, по крайней мере, в сообществе пользователей коммерческих баз данных термин репликация стал означать 
преимущественно (или даже исключительно) асинхронную репликацию.

Основное различие между репликацией и управлением копированием заключается в следующем:
Если используется репликация, то обновление одной реплики в конечном счёте распространяется на все остальные автоматически.
В режиме управления копированием, напротив, не существует такого автоматического распространения обновлений. 
Копии данных создаются и управляются с помощью пакетного или фонового процесса, который отделён во времени от транзакций обновления.
Управление копированием в общем более эффективно по сравнению с репликацией, поскольку за один раз могут копироваться 
большие объёмы данных. К недостаткам можно отнести то, что большую часть времени копии данных не идентичны базовым данным, 
поэтому пользователи должны учитывать, когда именно были синхронизированы эти данные.
Обычно управление копированием упрощается благодаря тому требованию, чтобы обновления применялись в соответствии со 
схемой первичной копии того или иного вида.

Для репликации PostgreSQL существует несколько решений, как закрытых, так и свободных. Самой популярной свободной системой 
репликации является Slony I\footnote{http://slony.info/}. Slony I поддерживает master/slaves репликацию. 

Возможные преимущества которые можно получить, наладив репликацию: 
\begin{itemize}
\item Организуются дополнительные копии данных, которые никогда лишними не бывают. Помним о благотворном влиянии паранойи.
\item Разгружается центральный сервер, теперь он может заниматься действитель но важными делами не отвлекаясь на мелочи. 
\end{itemize}

Например, процедура полного бэкапа довольно ресурсоёмкая. Вполне можно поручить это задание одному из вспомогательных серверов. 
Аналогично можно организовать сервер, который имеет очень длинный лог транзакций, чтобы можно было откатиться максимально далеко 
по времени в случае необходимости. 
\begin{itemize}
\item Можно перенести вспомогательный сервер поближе к клиенту, чтобы не было проблем со временем, которое уходит на подсоединение 
к базе данных,
\item Дополнительные сервера позволяют таки доступиться к данным, даже если связь с центральным сервером полностью потеряна.
\end{itemize}